<task id="bmad/value-ecosystem-design/tasks/workflow-executor.xml" name="Value Ecosystem Design Workflow Executor">
  <objective>Execute VED workflows with integrated agent orchestration for complete PVC ecosystem design pipeline</objective>

  <llm critical="true">
    <mandate>Always read COMPLETE workflow YAML files from {project-root}/bmad/value-ecosystem-design/workflows/</mandate>
    <mandate>Execute ALL steps in exact numerical order unless conditional logic dictates otherwise</mandate>
    <mandate>Process call-agent directives by loading and executing {project-root}/bmad/value-ecosystem-design/tasks/agent-orchestrator.xml</mandate>
    <mandate>Save template-output content to files in {output_folder} with {{date}} and {{variables}} resolved</mandate>
    <mandate>Handle elicit-required tags by processing {project-root}/bmad/core/tasks/adv-elicit.xml</mandate>
    <mandate>ALWAYS preserve context between workflow steps and agent calls</mandate>
  </llm>

  <WORKFLOW-RULES critical="true">
    <rule n="1">Load workflow YAML from module workflows directory, not core workflows</rule>
    <rule n="2">Execute steps sequentially with proper variable substitution</rule>
    <rule n="3">call-agent directives trigger agent-orchestrator.xml execution</rule>
    <rule n="4">template-output saves to module output_folder with professional formatting</rule>
    <rule n="5">elicit-required triggers enhanced agent collaboration</rule>
    <rule n="6">Context preservation across workflow and agent boundaries</rule>
  </WORKFLOW-RULES>

  <module-context>
    <paths>
      <workflows>{project-root}/bmad/value-ecosystem-design/workflows/</workflows>
      <templates>{project-root}/bmad/value-ecosystem-design/templates/</templates>
      <output>{output_folder}</output>
      <config>{project-root}/bmad/value-ecosystem-design/config.yaml</config>
    </paths>
    <capabilities>
      <feature>Agent orchestration via call-agent directives</feature>
      <feature>Template rendering with PVC toolkit worksheets</feature>
      <feature>Context preservation across fase transitions</feature>
      <feature>Interactive protocol support</feature>
    </capabilities>
  </module-context>

  <flow>
    <step n="1" title="Load and Initialize VED Workflow">
      <substep n="1a" title="Load Workflow Configuration">
        <action>Read complete workflow YAML from module workflows directory</action>
        <mandate>Load config_source (REQUIRED) from {project-root}/bmad/value-ecosystem-design/config.yaml</mandate>
        <mandate>Resolve all {config_source}: references with module config values</mandate>
        <mandate>Resolve system variables: {{date}}, {{user_name}}, {{communication_language}}</mandate>
        <mandate>Resolve path variables: {{project-root}}, {{output_folder}}, {{module_root}}</mandate>
        <mandate>Ask user for any unresolved variables</mandate>
      </substep>

      <substep n="1b" title="Initialize Execution Context">
        <action>Load template file if template: true in workflow</action>
        <action>Create output directory structure if needed</action>
        <action>Initialize context variables for agent orchestration</action>
        <action>Load knowledge base references for domain-specific validation</action>
      </substep>

      <substep n="1c" title="Validate Pre-Conditions">
        <action>Check required PVC phase context availability</action>
        <action>Validate agent availability for call-agent directives</action>
        <action>Verify template and knowledge base access</action>
        <check>if validation fails ‚Üí Provide clear error message and halt</check>
      </substep>
    </step>

    <step n="2" title="Execute Workflow Steps Sequentially">
      <iterate>For each step in workflow.steps:</iterate>

      <substep n="2a" title="Process Step Attributes">
        <check>If optional="true" ‚Üí Ask user "Include this step? (y/n)"</check>
        <check>If if="condition" ‚Üí Evaluate condition against context</check>
        <check>If for-each="collection" ‚Üí Repeat for each item</check>
        <check>If phase="canvas|ecosystem" ‚Üí Validate current fase context</check>
      </substep>

      <substep n="2b" title="Execute Step Instructions">
        <action>Process step.instructions with variable substitution</action>
        <action>Execute inline actions and checks</action>

        <execute-call-agent>
          <trigger>When step contains call-agent directive</trigger>
          <action>Load and execute {project-root}/bmad/value-ecosystem-design/tasks/agent-orchestrator.xml</action>
          <action>Pass agent name, context, and workflow state</action>
          <action>Receive results and integrate back into workflow context</action>
          <mandate>Preserve session continuity across agent boundaries</mandate>
        </execute-call-agent>
      </substep>

      <substep n="2c" title="Handle Output Tags">
        <if tag="template-output">
          <mandate>Generate professional PVC content using templates</mandate>
          <mandate>Save with incremental naming (worksheet-01, worksheet-02, etc.)</mandate>
          <action>Show checkpoint separator: ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</action>
          <action>Display generated content with clear PVC section headers</action>
          <ask>Continue [c] or Edit [e]? WAIT for response</ask>
        </if>

        <if tag="elicit-required">
          <mandate>Execute {project-root}/bmad/core/tasks/adv-elicit.xml</mandate>
          <action>Provide CIS agents for enhanced creative collaboration</action>
          <action>Integrate elicited insights into PVC content</action>
        </if>
      </substep>

      <substep n="2d" title="Step Completion">
        <check>If #yolo mode ‚Üí Skip confirmations</check>
        <check>Else ‚Üí Ask "Continue to next step? (y/n/edit)"</check>
        <action>Update workflow progress context</action>
      </substep>
    </step>

    <step n="3" title="Workflow Completion & Validation">
      <check>If template-workflow ‚Üí Confirm deliverable saved to output path</check>
      <check>If checklist exists ‚Üí Run PVC completeness validation</check>

      <pvc-validation>
        <check>Phase 1 Canvas: Problem, Stakeholders, Values, Solutions identified</check>
        <check>Phase 2 Ecosystem: Architecture, Implementation, Validation complete</check>
        <check>Cross-phase: Context preserved, iterations supported</check>
      </pvc-validation>

      <action>Report workflow completion with next steps</action>
      <output>
        üéØ **VED Workflow Complete**

        **Deliverables Generated:**
        - {{number}} PVC worksheets saved to {{output_folder}}
        - Professional canvases ready for implementation
        - Validation reports for compliance and completeness

        **Next Steps:**
        - Review generated PVC toolkit worksheets
        - Proceed to next fase if applicable
        - Iterate with additional workflows as needed

        **Available Follow-up Workflows:**
        - Phase 1 Refinement: `canvas-foundation`
        - Phase 2 Implementation: `ecosystem-design-pipeline`
        - Validation: `correct-course`
      </output>
    </step>
  </flow>

  <execution-modes>
    <mode name="normal">Full user collaboration with agent orchestration</mode>
    <mode name="#yolo">Skip optional steps, minimal confirmations, fast execution</mode>
    <mode name="canvas-focus">Emphasize creative Phase 1 exploration</mode>
    <mode name="ecosystem-focus">Emphasize scientific Phase 2 validation</mode>
  </execution-modes>

  <pvc-integration>
    <phase1-canvas>
      <worksheet>Problem Exploration (5W + conditions)</worksheet>
      <worksheet>Future Vision Scenarios (What If)</worksheet>
      <worksheet>Team Environment Mapping</worksheet>
      <worksheet>Public Value Proposition Crafting</worksheet>
      <worksheet>Stakeholder Basics Analysis</worksheet>
      <worksheet>Capacity & Support Assessment</worksheet>
      <worksheet>Canvas Completion Validation</worksheet>
    </phase1-canvas>
    <phase2-ecosystem>
      <worksheet>Ecosystem Architecture Design</worksheet>
      <worksheet>Implementation Planning</worksheet>
      <worksheet>Risk Mitigation Strategy</worksheet>
      <worksheet>Success Metrics Definition</worksheet>
    </phase2-ecosystem>
  </pvc-integration>

  <supported-tags desc="VED-specific workflow tags">
    <execution>
      <tag>call-agent agent="name" - Trigger agent orchestration</tag>
      <tag>phase="canvas|ecosystem" - Fase-specific validation</tag>
      <tag>elicit-required agent="type" - Enhanced collaboration</tag>
    </execution>
    <output>
      <tag>template-output pvc="worksheet-name" - PVC-specific output</tag>
      <tag>validation phase="1|2" - Cross-phase validation</tag>
    </output>
  </supported-tags>

  <llm final="true">
    <mandate>This is the complete VED workflow execution engine</mandate>
    <mandate>You MUST execute workflows within the value-ecosystem-design module scope</mandate>
    <mandate>Agent orchestration is built into the workflow execution via call-agent directives</mandate>
    <mandate>PVC toolkit integration provides professional public value design capabilities</mandate>
    <mandate>Always maintain conversation context across workflow boundaries and agent interactions</mandate>
  </llm>
</task>
